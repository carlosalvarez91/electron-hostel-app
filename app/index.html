<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <link rel="stylesheet" href="photon.min.css">
  </head>
  <body>
    <h1>Hello World!</h1>
    We are using node <script>document.write(process.versions.node)</script>,
    Chrome <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.
  </body>
  <table id="tableAll">
      <tr>
        <th>Date</th>
        <th>Name</th>
        <th>Surname</th>
        <th>Room</th>
        <th>Heads</th>
        <th>Nights</th>
        <th>Price</th>
        <th>Payment</th>
      </tr>
  </table>
  <script>
  const electron = require('electron');
  const{ipcRenderer} = electron;
  const sqlite3 = require('sqlite3').verbose();
  const db = new sqlite3.Database('app/db/database.sqlite3');
  db.serialize(function() {
    // Render all receipts from db
    db.each("SELECT rowid AS id, date, name, surname , room , heads , nights , price , payment  FROM bookings", function(err, row) {
    var a =[];
    a.push(row);
    for (var i = 0; i < a.length; i++) {
        var tr = document.createElement("tr")
        for (var key of ['date', 'name', 'surname', 'room', 'heads', 'nights', 'price', 'payment']) {
          var td = document.createElement("td")
          td.innerHTML = a[i][key]
          tr.appendChild(td)
        }
        document.getElementById("tableAll").appendChild(tr);
      }
    });
  //render the checkIn input data into a table
  ipcRenderer.on('check-in-input',(e,{date, name, surname, room, heads, nights, price, payment})=>{
    var newRow = `<tr>
                  <td>${date}</td>
                  <td>${name}</td>
                  <td>${surname}</td>
                  <td>${room}</td>
                  <td>${heads}</td>
                  <td>${nights}</td>
                  <td>${price}</td>
                  <td>${payment}</td>
                </tr>`;
    document.getElementById("tableAll").innerHTML += newRow;
  })
    // sum card
    db.each("SELECT SUM(price) FROM bookings WHERE payment = 'card' ", function(err, totalCard) {
      console.log('total card: ' + totalCard["SUM(price)"]);
    });
    //sum cash
    db.each("SELECT SUM(price) FROM bookings WHERE payment = 'cash' ", function(err, totalCash) {
      console.log('total cash: '+totalCash["SUM(price)"]);
    });
    //sum total
    db.each("SELECT SUM(price) FROM bookings", function(err, total) {
    console.log('grand total: '+total["SUM(price)"]);
    });
  });
  </script>
</html>