<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <link rel="stylesheet" href="photon.min.css">
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
    <div id="loginScreen">
        <form>
            <div class="form-group">
                <label>Receptionist Name:</label>
                <input type="text" class="form-control" id="receptionistName">
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-large btn-default">Login</button>
            </div>
        </form>
    </div>

      <h2>Hello <span id="greeting"></span></h2>  
      <button onclick="logout()"id="logout" class="btn btn-large btn-negative">Log Out</button>
  <table id="tableAll">
      <tr>
        <th>Date</th>
        <th>Name</th>
        <th>Surname</th>
        <th>Room</th>
        <th>Heads</th>
        <th>Nights</th>
        <th>Price</th>
        <th>Payment</th>
      </tr>
  </table>
</body>
<script>
  //Login Page
  document.querySelector('form').addEventListener('submit', login);
  function login(e){
    e.preventDefault();
    let receptionistName = document.querySelector('#receptionistName').value;
    if(receptionistName != ''){
      // New local storage when press login and store temporary all receiots until press Logout.
      // at the same time save in sqlite permanent all receipts for the  weekly total.
      // store receptionistNAme as a global var 
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('logout').style.display = 'block';
      document.getElementById('greeting').innerHTML = receptionistName;

      ipcRenderer.send('login',receptionistName);
    }else{
      console.log('Write your name madafakaa!!')
    }
  }
  //logout
  function logout(e){
    document.getElementById('loginScreen').style.display = 'block';
  }
</script>
  <script>
  const electron = require('electron');
  const{ipcRenderer} = electron;
  const sqlite3 = require('sqlite3').verbose();
  const db = new sqlite3.Database('app/db/database.sqlite3');
  db.serialize(function() {
    // Render all receipts from db
    db.each("SELECT rowid AS id, date, name, surname , room , heads , nights , price , payment  FROM bookings", function(err, row) {
    var a =[];
    a.push(row);
    for (var i = 0; i < a.length; i++) {
        var tr = document.createElement("tr")
        for (var key of ['date', 'name', 'surname', 'room', 'heads', 'nights', 'price', 'payment']) {
          var td = document.createElement("td")
          td.innerHTML = a[i][key]
          tr.appendChild(td)
        }
        document.getElementById("tableAll").appendChild(tr);
      }
    });
  //render the checkIn input data into a table
  ipcRenderer.on('check-in-input',(e,{date, name, surname, room, heads, nights, price, payment})=>{
    var newRow = `<tr>
                  <td>${date}</td>
                  <td>${name}</td>
                  <td>${surname}</td>
                  <td>${room}</td>
                  <td>${heads}</td>
                  <td>${nights}</td>
                  <td>${price}</td>
                  <td>${payment}</td>
                </tr>`;
    document.getElementById("tableAll").innerHTML += newRow;
  })
    // sum card
    db.each("SELECT SUM(price) FROM bookings WHERE payment = 'card' ", function(err, totalCard) {
      console.log('total card: ' + totalCard["SUM(price)"]);
    });
    //sum cash
    db.each("SELECT SUM(price) FROM bookings WHERE payment = 'cash' ", function(err, totalCash) {
      console.log('total cash: '+totalCash["SUM(price)"]);
    });
    //sum total
    db.each("SELECT SUM(price) FROM bookings", function(err, total) {
    console.log('grand total: '+total["SUM(price)"]);
    });
  });
  </script>
</html>